# ğŸ—ï¸ SOC Architecture Documentation

**Project:** AI-Powered Alert Prioritization for Wazuh  
**Version:** 1.0  
**Date:** 2025-12-14  
**Perspective:** SOC (Security Operations Center)

---

## ğŸ“‹ TABLE OF CONTENTS

1. [Executive Summary](#executive-summary)
2. [Network Architecture](#network-architecture)
3. [System Components](#system-components)
4. [Data Flow](#data-flow)
5. [Attack Scenario](#attack-scenario)
6. [Detection & Response Flow](#detection--response-flow)
7. [AI Processing Pipeline](#ai-processing-pipeline)
8. [Notification & Orchestration](#notification--orchestration)
9. [Implementation Details](#implementation-details)
10. [Security Considerations](#security-considerations)

---

## ğŸ¯ EXECUTIVE SUMMARY

This document describes the architecture of an AI-powered Security Operations Center (SOC) pipeline that enhances Wazuh SIEM capabilities with intelligent alert prioritization, contextual analysis, and automated response orchestration.

**Key Capabilities:**
- Real-time alert collection from Wazuh Indexer
- AI-powered threat analysis and prioritization
- Automated correlation and enrichment
- Integration with n8n for workflow automation
- Critical attack override mechanism

---

## ğŸŒ NETWORK ARCHITECTURE

### **Network Topology**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INTERNET                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ WAN: 172.16.69.176
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚
                    â”‚    pfSense      â”‚
                    â”‚   Firewall      â”‚
                    â”‚                 â”‚
                    â”‚  WAN: 172.16.69.176                          â”‚
                    â”‚  LAN: 192.168.10.1                           â”‚
                    â”‚  DMZ: 192.168.20.1                           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚        â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                   â”‚
                â”‚ LAN: 192.168.10.0/24              â”‚ DMZ: 192.168.20.0/24
                â”‚                                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                       â”‚          â”‚                       â”‚
    â”‚   Wazuh Server        â”‚          â”‚   WebServer (DVWA)    â”‚
    â”‚   192.168.10.128      â”‚          â”‚   192.168.20.125      â”‚
    â”‚                       â”‚          â”‚                       â”‚
    â”‚  - Wazuh Manager      â”‚          â”‚  - Apache Web Server  â”‚
    â”‚  - Wazuh Indexer      â”‚          â”‚  - DVWA Application   â”‚
    â”‚  - Wazuh API          â”‚          â”‚  - Wazuh Agent 001    â”‚
    â”‚  - OpenSearch         â”‚          â”‚  - Suricata IDS       â”‚
    â”‚                       â”‚          â”‚  - Auditd             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                   â”‚
                â”‚                                   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Wazuh Agent Communication
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                       â”‚
                â”‚   SOC Pipeline        â”‚
                â”‚   (This Project)      â”‚
                â”‚                       â”‚
                â”‚  - Alert Collector    â”‚
                â”‚  - AI Analyzer        â”‚
                â”‚  - Triage Engine      â”‚
                â”‚  - Notification       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Webhook
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                       â”‚
                â”‚   n8n Workflow       â”‚
                â”‚   172.16.69.160:5678 â”‚
                â”‚                       â”‚
                â”‚  - Alert Processing   â”‚
                â”‚  - Ticket Creation   â”‚
                â”‚  - Slack/Email        â”‚
                â”‚  - Response Actions   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **Enterprise Network Diagram**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ENTERPRISE NETWORK ARCHITECTURE                           â”‚
â”‚                         (Chuáº©n Máº¡ng Doanh Nghiá»‡p)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EXTERNAL NETWORK                                    â”‚
â”‚                         (Untrusted Zone)                                     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚                    [ATTACKER]                                        â”‚  â”‚
â”‚  â”‚                   172.16.69.175/24                                  â”‚  â”‚
â”‚  â”‚                   (External Threat Source)                           â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                           â”‚
â”‚                                  â”‚ Internet Connection                       â”‚
â”‚                                  â”‚ Protocol: HTTP/HTTPS                      â”‚
â”‚                                  â”‚ Direction: Inbound Attack Traffic         â”‚
â”‚                                  â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ WAN Interface
                                   â”‚ 172.16.69.176
                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PERIMETER SECURITY LAYER                                   â”‚
â”‚                    (Network Gateway & Firewall)                               â”‚
â”‚                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚                    [PFSENSE FIREWALL]                                   â”‚  â”‚
â”‚  â”‚                    (Network Security Gateway)                           â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Network Interfaces:                                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ WAN Interface                                              â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ IP: 172.16.69.176                                         â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Network: 172.16.69.0/24                                   â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Function: Internet-facing gateway                          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Security: Untrusted zone                                   â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ LAN Interface                                               â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ IP: 192.168.10.1                                           â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Network: 192.168.10.0/24                                   â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Function: Internal network gateway                          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Security: Trusted zone                                      â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ DMZ Interface                                               â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ IP: 192.168.20.1                                           â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Network: 192.168.20.0/24                                  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Function: DMZ network gateway                              â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Security: Semi-trusted zone                                â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Security Functions:                                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Stateful Packet Inspection (SPI)                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Network Address Translation (NAT)                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Port Forwarding (WAN â†’ DMZ)                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Access Control Lists (ACLs)                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Intrusion Detection/Prevention                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                               â”‚
                â”‚ LAN Network                   â”‚ DMZ Network
                â”‚ 192.168.10.0/24              â”‚ 192.168.20.0/24
                â”‚ (Trusted Zone)                â”‚ (Semi-trusted Zone)
                â”‚                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTERNAL NETWORK (LAN)                                    â”‚
â”‚                    (Trusted Zone - 192.168.10.0/24)                          â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  [AI SYSTEM]                                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  IP: 192.168.10.49                                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Role: AI-Powered Alert Analysis                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Components:                                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - OpenAI GPT-5.2 Integration                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Alert Context Analysis                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Threat Intelligence                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Natural Language Processing                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Communication:                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Inbound: Receives alerts from SOC Pipeline                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Outbound: OpenAI API (api.openai.com:443/HTTPS)              â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  [WAZUH SIEM]                                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  IP: 192.168.10.128                                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Role: Security Information and Event Management                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Components:                                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Wazuh Manager                                              â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Port: 1514 (UDP/TCP)                                       â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Function: Central management and correlation               â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Wazuh Indexer (OpenSearch)                                â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Port: 9200 (HTTPS)                                        â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Function: Alert storage and search                         â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Index: wazuh-alerts-*                                      â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Wazuh API                                                 â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Port: 55000 (HTTPS)                                       â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Function: RESTful API for management                     â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Auth: Basic Auth / Token                                  â”‚ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Communication:                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Inbound: Agent alerts (Port 1514)                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Inbound: SOC Pipeline queries (Port 9200)                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Inbound: Management API (Port 55000)                       â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  [SOC PIPELINE]                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  IP: 192.168.10.128 (or local development)                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Role: AI-Powered Alert Prioritization System                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Components:                                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Alert Collector                                           â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ â†’ Wazuh Indexer (192.168.10.128:9200/HTTPS)              â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Heuristic Analyzer                                        â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ (Rule-based scoring)                                      â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ AI Analyzer                                               â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ â†’ AI System (192.168.10.49)                              â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ â†’ OpenAI API (api.openai.com:443/HTTPS)                  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Triage Engine                                             â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ (Score fusion)                                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Notification                                              â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ â†’ n8n Webhook (172.16.69.160:5678/HTTP)                  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ DMZ Network
                                   â”‚ 192.168.20.0/24
                                   â”‚ (Semi-trusted Zone)
                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DMZ NETWORK                                                 â”‚
â”‚                    (Demilitarized Zone - 192.168.20.0/24)                     â”‚
â”‚                                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  [WEBSERVER + SURICATA]                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  IP: 192.168.20.125                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Role: Public-facing Web Application with IDS                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Components:                                                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Apache Web Server                                          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Port: 80 (HTTP)                                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Function: Web application hosting                           â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Logs: /var/log/apache2/access.log                          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ DVWA Application                                           â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ (Damn Vulnerable Web Application)                          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Vulnerabilities:                                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - SQL Injection (/dvwa/vulnerabilities/sqli/)             â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - XSS (/dvwa/vulnerabilities/xss_r/)                      â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - Command Injection (/dvwa/vulnerabilities/exec/)         â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - CSRF (/dvwa/vulnerabilities/csrf/)                      â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Wazuh Agent 001                                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Port: 1514 (UDP/TCP)                                       â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Function: Security monitoring                              â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Monitors:                                                  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - Apache access.log                                        â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - File Integrity Monitoring (FIM)                          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - System logs                                              â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ â†’ Wazuh Manager (192.168.10.128:1514)                     â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Suricata IDS                                               â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Function: Network Intrusion Detection System               â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Monitors:                                                  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - HTTP/HTTPS traffic                                       â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - Attack pattern detection                                 â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - Generates alerts (Rule 100101, Level 12)                â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Auditd                                                      â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Function: System call monitoring                            â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ Monitors:                                                  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - Command execution                                        â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - Network connections                                      â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - File access                                              â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ - Generates alerts (Rule 110231, Level 13)                â”‚  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Communication:                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Inbound: HTTP traffic from Internet (Port 80)                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Outbound: Agent alerts to Wazuh Manager (Port 1514)          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL AUTOMATION LAYER                                 â”‚
â”‚                    (External Network)                                         â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  [N8N WORKFLOW AUTOMATION]                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  IP: 172.16.69.160                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Port: 5678 (HTTP)                                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Role: Workflow Automation & Orchestration                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Functions:                                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Receive webhook notifications from SOC Pipeline               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Create tickets (TheHive/Jira/ServiceNow)                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Send notifications (Slack/Email/SMS)                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Trigger response actions (Block IP/Isolate Host)              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Communication:                                                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Inbound: HTTP POST from SOC Pipeline (Port 5678)              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Outbound: API calls to Wazuh/pfSense for response actions    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATA FLOW SUMMARY                                    â”‚
â”‚                                                                               â”‚
â”‚  1. ATTACK FLOW:                                                              â”‚
â”‚     Attacker (172.16.69.175)                                                 â”‚
â”‚     â†’ WAN (172.16.69.176)                                                    â”‚
â”‚     â†’ pfSense Firewall (NAT Translation)                                      â”‚
â”‚     â†’ DMZ (192.168.20.1)                                                     â”‚
â”‚     â†’ WebServer (192.168.20.125:80)                                          â”‚
â”‚                                                                               â”‚
â”‚  2. DETECTION FLOW:                                                           â”‚
â”‚     WebServer Components (Suricata/Auditd/Wazuh Agent)                      â”‚
â”‚     â†’ Wazuh Agent 001 (Port 1514)                                            â”‚
â”‚     â†’ Wazuh Manager (192.168.10.128:1514)                                    â”‚
â”‚     â†’ Wazuh Indexer (192.168.10.128:9200)                                    â”‚
â”‚                                                                               â”‚
â”‚  3. ANALYSIS FLOW:                                                            â”‚
â”‚     SOC Pipeline (192.168.10.128)                                            â”‚
â”‚     â†’ Wazuh Indexer (192.168.10.128:9200/HTTPS)                              â”‚
â”‚     â†’ AI System (192.168.10.49)                                              â”‚
â”‚     â†’ OpenAI API (api.openai.com:443/HTTPS)                                  â”‚
â”‚     â†’ Triage Engine                                                          â”‚
â”‚     â†’ Notification                                                           â”‚
â”‚                                                                               â”‚
â”‚  4. NOTIFICATION FLOW:                                                         â”‚
â”‚     SOC Pipeline                                                              â”‚
â”‚     â†’ n8n Webhook (172.16.69.160:5678/HTTP)                                  â”‚
â”‚     â†’ Ticket Creation / Slack / Email                                        â”‚
â”‚                                                                               â”‚
â”‚  5. RESPONSE FLOW:                                                            â”‚
â”‚     n8n Workflow                                                             â”‚
â”‚     â†’ Wazuh API (192.168.10.128:55000/HTTPS)                                 â”‚
â”‚     â†’ pfSense API (172.16.69.176)                                             â”‚
â”‚     â†’ Block IP / Isolate Host                                                 â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ATTACK SCENARIO

### **Attacker Information:**
- **IP Address:** 172.16.69.175
- **Location:** External (Internet)
- **Target:** WebServer (192.168.20.125) in DMZ

### **Attack Flow:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Attacker      â”‚
â”‚ 172.16.69.175   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. HTTP Request
         â”‚    GET /dvwa/vulnerabilities/sqli/?id=1' OR '1'='1
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    pfSense Firewall                     â”‚
â”‚  WAN: 172.16.69.176                                     â”‚
â”‚  DMZ: 192.168.20.1                                      â”‚
â”‚                                                          â”‚
â”‚  - NAT Translation                                       â”‚
â”‚  - Firewall Rules                                        â”‚
â”‚  - Suricata IDS (Agent 002)                              â”‚
â”‚    â†’ Detects SQL Injection Pattern                      â”‚
â”‚    â†’ Generates Alert (Rule 100100, Level 3)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ 2. Forward Traffic
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WebServer (DMZ)                            â”‚
â”‚              192.168.20.125                              â”‚
â”‚                                                          â”‚
â”‚  Components:                                             â”‚
â”‚  - Apache Web Server                                     â”‚
â”‚    â†’ Logs request to access.log                         â”‚
â”‚  - DVWA Application                                      â”‚
â”‚    â†’ Processes SQL injection attempt                     â”‚
â”‚  - Wazuh Agent 001                                       â”‚
â”‚    â†’ Monitors access.log                                 â”‚
â”‚    â†’ Detects SQL Injection (Rule 31103, Level 7)        â”‚
â”‚    â†’ Sends alert to Wazuh Manager                        â”‚
â”‚  - Suricata IDS                                          â”‚
â”‚    â†’ Detects attack pattern                              â”‚
â”‚    â†’ Generates alert (Rule 100101, Level 12)             â”‚
â”‚  - Auditd                                                â”‚
â”‚    â†’ Monitors system calls                               â”‚
â”‚    â†’ Detects command execution (Rule 110231, Level 13)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ 3. Agent â†’ Manager Communication
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Wazuh Manager                              â”‚
â”‚              192.168.10.128                             â”‚
â”‚                                                          â”‚
â”‚  Components:                                             â”‚
â”‚  - Wazuh Manager                                         â”‚
â”‚    â†’ Receives alerts from agents                         â”‚
â”‚    â†’ Applies rules and correlation                       â”‚
â”‚    â†’ Stores in Wazuh Indexer                            â”‚
â”‚  - Wazuh Indexer (OpenSearch)                           â”‚
â”‚    â†’ Indexes alerts in wazuh-alerts-*                    â”‚
â”‚    â†’ Provides search API                                 â”‚
â”‚  - Wazuh API                                             â”‚
â”‚    â†’ RESTful API for management                          â”‚
â”‚    â†’ Port 55000 (HTTPS)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ 4. Indexer Query (REST API)
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          SOC Pipeline (This Project)                    â”‚
â”‚          Running on: 192.168.10.128 (or local)          â”‚
â”‚                                                          â”‚
â”‚  Components:                                             â”‚
â”‚  1. Alert Collector (wazuh_client.py)                   â”‚
â”‚     â†’ Queries Wazuh Indexer                             â”‚
â”‚     â†’ Fetches alerts from wazuh-alerts-*                 â”‚
â”‚     â†’ Normalizes alert data                              â”‚
â”‚                                                          â”‚
â”‚  2. Heuristic Analyzer (heuristic.py)                   â”‚
â”‚     â†’ Calculates base score from rule level              â”‚
â”‚     â†’ Applies rule-specific weights                     â”‚
â”‚                                                          â”‚
â”‚  3. AI Analyzer (llm.py)                                 â”‚
â”‚     â†’ Sends alert context to OpenAI GPT-5.2              â”‚
â”‚     â†’ Analyzes threat level and context                  â”‚
â”‚     â†’ Generates summary and tags                         â”‚
â”‚                                                          â”‚
â”‚  4. Triage Engine (triage.py)                            â”‚
â”‚     â†’ Combines heuristic + AI scores                     â”‚
â”‚     â†’ Applies dynamic weighting                          â”‚
â”‚     â†’ Determines final threat level                      â”‚
â”‚                                                          â”‚
â”‚  5. Notification (notify.py)                            â”‚
â”‚     â†’ Checks if alert exceeds threshold                  â”‚
â”‚     â†’ Applies critical attack override                   â”‚
â”‚     â†’ Sends to n8n webhook                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ 5. HTTP POST to Webhook
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              n8n Workflow Automation                    â”‚
â”‚              172.16.69.160:5678                          â”‚
â”‚                                                          â”‚
â”‚  Workflow Steps:                                         â”‚
â”‚  1. Receive Webhook                                     â”‚
â”‚  2. Parse Alert Data                                     â”‚
â”‚  3. Check Alert Severity                                â”‚
â”‚  4. Create Ticket (TheHive/Jira)                        â”‚
â”‚  5. Send Slack Notification                             â”‚
â”‚  6. Send Email Alert                                    â”‚
â”‚  7. Trigger Response Actions                            â”‚
â”‚     - Block IP (pfSense API)                            â”‚
â”‚     - Isolate Host                                       â”‚
â”‚     - Escalate to SOC Team                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© SYSTEM COMPONENTS

### **1. pfSense Firewall (Network Gateway)**

**Interfaces:**
- **WAN:** 172.16.69.176 (Internet-facing)
- **LAN:** 192.168.10.1 (Internal network)
- **DMZ:** 192.168.20.1 (DMZ network)

**Components:**
- **Suricata IDS (Agent 002):**
  - Monitors network traffic
  - Detects attack patterns
  - Generates alerts (Rule 100100, Level 3)
  - Sends to Wazuh Manager

**Role:**
- Network segmentation
- Traffic inspection
- Initial attack detection
- NAT translation

---

### **2. WebServer (DMZ - 192.168.20.125)**

**Components:**
- **Apache Web Server:**
  - Serves DVWA application
  - Logs all requests to access.log
  - Port 80 (HTTP)

- **DVWA (Damn Vulnerable Web Application):**
  - SQL Injection vulnerable endpoint
  - Command Injection vulnerable endpoint
  - XSS vulnerable endpoint
  - CSRF vulnerable endpoint

- **Wazuh Agent 001:**
  - Monitors access.log
  - Detects SQL Injection (Rule 31103, Level 7)
  - Detects XSS (Rule 31105, Level 7)
  - Detects Command Injection (Rule 100130, Level 7)
  - Monitors file changes (FIM - Rule 110201, Level 10)
  - Monitors command execution (Auditd - Rule 110231, Level 13)

- **Suricata IDS:**
  - Network-based detection
  - Detects attack patterns in HTTP traffic
  - Generates alerts (Rule 100101, Level 12)

- **Auditd:**
  - Monitors system calls
  - Detects command execution
  - Detects network connections (Rule 110231, Level 13)

**Role:**
- Hosts vulnerable application
- Generates security events
- Sends alerts to Wazuh Manager

---

### **3. Wazuh Server (LAN - 192.168.10.128)**

**Components:**
- **Wazuh Manager:**
  - Receives alerts from agents
  - Applies rules and correlation
  - Stores alerts in indexer
  - Port 1514 (UDP/TCP) for agent communication

- **Wazuh Indexer (OpenSearch):**
  - Indexes alerts in `wazuh-alerts-*`
  - Provides search API
  - Port 9200 (HTTPS)
  - Indexer delay: 5-30 seconds

- **Wazuh API:**
  - RESTful API for management
  - Port 55000 (HTTPS)
  - Authentication: Basic Auth or Token

**Role:**
- Central SIEM platform
- Alert storage and indexing
- Rule engine and correlation
- API for alert retrieval

---

### **4. SOC Pipeline (This Project)**

**Components:**

#### **4.1. Alert Collector (`src/collector/wazuh_client.py`)**
- **Function:** Fetches alerts from Wazuh Indexer
- **Method:** OpenSearch REST API queries
- **Features:**
  - Cursor-based pagination
  - Agent-specific queries (balanced distribution)
  - Time window filtering
  - Indexer delay compensation
  - Alert normalization

**Configuration:**
```python
WAZUH_INDEXER_URL=https://192.168.10.128:9200
WAZUH_INDEXER_USER=admin
WAZUH_INDEXER_PASS=admin
WAZUH_INDEXER_VERIFY_SSL=false
WAZUH_START_FROM_NOW=true
WAZUH_LOOKBACK_MINUTES=5
INDEXER_DELAY_SECONDS=5
```

#### **4.2. Heuristic Analyzer (`src/analyzer/heuristic.py`)**
- **Function:** Calculates base threat score
- **Method:** Rule-based scoring
- **Factors:**
  - Rule level (0-15)
  - Rule groups (attack, web, sql_injection, etc.)
  - Specific rule IDs (31103, 31105, 100130, etc.)

**Scoring:**
```python
Base Score = rule_level / 15
Group Bonus = +0.1 for attack groups
Rule ID Bonus = +0.15 for critical rules (31103, 31105, etc.)
Final Score = Base Score + Bonuses (capped at 1.0)
```

#### **4.3. AI Analyzer (`src/analyzer/llm.py`)**
- **Function:** AI-powered threat analysis
- **Method:** OpenAI GPT-5.2 API
- **Input:**
  - Alert context (rule, description, message)
  - Network information (src_ip, dest_ip, ports)
  - HTTP context (method, URI, status, redirect)
  - Flow statistics (bytes, packets)
  - Rule metadata (fired times, location)

**Output:**
- Threat level (low, medium, high, critical)
- Confidence score (0.0-1.0)
- Tags (web_attack, sql_injection, xss, etc.)
- Summary (human-readable analysis)

**Configuration:**
```python
LLM_ENABLE=true
OPENAI_API_KEY=sk-proj-...
OPENAI_API_BASE=https://api.openai.com/v1
LLM_MODEL=gpt-5.2
LLM_MAX_TOKENS=1024
```

#### **4.4. Triage Engine (`src/analyzer/triage.py`)**
- **Function:** Combines heuristic + AI scores
- **Method:** Dynamic weighted fusion
- **Formula:**
```python
if llm_confidence >= 0.8:
    h_weight = 0.5
    l_weight = 0.5
elif llm_confidence >= 0.6:
    h_weight = 0.6
    l_weight = 0.4
else:
    h_weight = 0.7
    l_weight = 0.3

final_score = (heuristic_score * h_weight) + (llm_score * l_weight)
```

**Features:**
- Dynamic weighting based on LLM confidence
- Threat level adjustment
- Rule-specific boosts (XSS, SQL Injection, Command Injection)
- MITRE ATT&CK mapping

#### **4.5. Notification (`src/orchestrator/notify.py`)**
- **Function:** Sends alerts to external systems
- **Method:** HTTP POST to n8n webhook
- **Conditions:**
  - Score >= TRIAGE_THRESHOLD (0.70)
  - OR Critical Attack Override (Rule 110231, Level 13, etc.)

**Critical Attack Override:**
```python
CRITICAL_ATTACK_RULES = {
    "110231",  # CONFIRMED: Network connect (reverse shell)
    "110230",  # CONFIRMED: Command execution
    "110202",  # CONFIRMED: Webshell indicators
    "100130",  # Command Injection
    "100140",  # Suspicious Upload
    "31110",   # CSRF attempt
    "100160",  # HTTP DoS
    "100170",  # TCP SYN Flood
}
```

**Configuration:**
```python
N8N_WEBHOOK_URL=http://172.16.69.160:5678/webhook/...
TRIAGE_THRESHOLD=0.70
```

---

### **5. n8n Workflow Automation (172.16.69.160:5678)**

**Components:**
- **Webhook Trigger:**
  - Receives HTTP POST from SOC Pipeline
  - Parses alert JSON payload

- **Workflow Steps:**
  1. **Parse Alert Data:**
     - Extract threat level, score, summary
     - Extract source/destination IPs
     - Extract rule information

  2. **Check Severity:**
     - If CRITICAL â†’ Immediate escalation
     - If HIGH â†’ Create ticket
     - If MEDIUM â†’ Log for review

  3. **Create Ticket:**
     - TheHive case creation
     - Jira ticket creation
     - ServiceNow incident

  4. **Send Notifications:**
     - Slack channel alert
     - Email to SOC team
     - SMS for critical alerts

  5. **Response Actions:**
     - Block IP in pfSense (API call)
     - Isolate host (Wazuh agent action)
     - Escalate to SOC analyst

**Role:**
- Workflow automation
- Ticket management
- Notification distribution
- Response orchestration

---

## ğŸ”„ DATA FLOW

### **Complete Attack-to-Response Flow:**

```
1. ATTACK INITIATION
   â””â”€> Attacker (172.16.69.175) sends SQL injection payload
       â””â”€> GET /dvwa/vulnerabilities/sqli/?id=1' OR '1'='1

2. NETWORK DETECTION
   â””â”€> pfSense Suricata (Agent 002) detects pattern
       â””â”€> Generates Alert: Rule 100100, Level 3
       â””â”€> Sends to Wazuh Manager

3. HOST DETECTION
   â””â”€> WebServer (192.168.20.125) receives request
       â”œâ”€> Apache logs to access.log
       â”œâ”€> Wazuh Agent 001 detects SQL Injection
       â”‚   â””â”€> Generates Alert: Rule 31103, Level 7
       â”œâ”€> Suricata detects attack pattern
       â”‚   â””â”€> Generates Alert: Rule 100101, Level 12
       â””â”€> All alerts sent to Wazuh Manager

4. SIEM PROCESSING
   â””â”€> Wazuh Manager receives alerts
       â”œâ”€> Applies rules and correlation
       â”œâ”€> Stores in Wazuh Indexer (OpenSearch)
       â””â”€> Indexer delay: 5-30 seconds

5. SOC PIPELINE COLLECTION
   â””â”€> Alert Collector queries Wazuh Indexer
       â”œâ”€> Uses cursor-based pagination
       â”œâ”€> Fetches alerts from last 5 minutes
       â”œâ”€> Normalizes alert data
       â””â”€> Returns normalized alerts

6. HEURISTIC ANALYSIS
   â””â”€> Heuristic Analyzer calculates base score
       â”œâ”€> Rule 31103 (Level 7) â†’ Base: 0.47
       â”œâ”€> SQL Injection group â†’ +0.1
       â”œâ”€> Critical rule ID â†’ +0.15
       â””â”€> Final heuristic score: 0.72

7. AI ANALYSIS
   â””â”€> AI Analyzer sends to OpenAI GPT-5.2
       â”œâ”€> Input: Alert context, network info, HTTP context
       â”œâ”€> Output:
       â”‚   â”œâ”€> Threat Level: CRITICAL
       â”‚   â”œâ”€> Confidence: 1.0
       â”‚   â”œâ”€> Tags: ["web_attack", "sql_injection", "wazuh_rule_high"]
       â”‚   â””â”€> Summary: "SQL injection attempt detected..."
       â””â”€> LLM Score: 0.95

8. TRIAGE FUSION
   â””â”€> Triage Engine combines scores
       â”œâ”€> Heuristic: 0.72 (weight: 0.5)
       â”œâ”€> LLM: 0.95 (weight: 0.5)
       â”œâ”€> Final Score: (0.72 * 0.5) + (0.95 * 0.5) = 0.835
       â””â”€> Threat Level: HIGH (score > 0.70)

9. NOTIFICATION DECISION
   â””â”€> Notification checks conditions
       â”œâ”€> Score (0.835) >= Threshold (0.70) â†’ âœ… Notify
       â””â”€> OR Critical Attack Override â†’ âœ… Notify

10. WEBHOOK DELIVERY
    â””â”€> HTTP POST to n8n webhook
        â”œâ”€> URL: http://172.16.69.160:5678/webhook/...
        â”œâ”€> Payload: Alert JSON with all context
        â””â”€> Headers: Content-Type: application/json

11. N8N WORKFLOW EXECUTION
    â””â”€> n8n receives webhook
        â”œâ”€> Parse alert data
        â”œâ”€> Check severity (HIGH)
        â”œâ”€> Create ticket (TheHive/Jira)
        â”œâ”€> Send Slack notification
        â”œâ”€> Send email alert
        â””â”€> Trigger response actions (optional)

12. RESPONSE ACTIONS
    â””â”€> Automated or manual response
        â”œâ”€> Block IP in pfSense (172.16.69.175)
        â”œâ”€> Isolate WebServer (if critical)
        â””â”€> Escalate to SOC analyst
```

---

## ğŸ¤– AI PROCESSING PIPELINE

### **AI Analysis Workflow:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Alert Normalization                        â”‚
â”‚                                                          â”‚
â”‚  Input: Raw Wazuh Alert                                 â”‚
â”‚  Output: Normalized Alert with:                          â”‚
â”‚    - Core fields (rule_id, level, description)          â”‚
â”‚    - Network 5-tuple (src_ip, dest_ip, ports, proto)    â”‚
â”‚    - HTTP context (method, URI, status, redirect)        â”‚
â”‚    - Flow statistics (bytes, packets)                    â”‚
â”‚    - Rule metadata (fired times, location)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PII Redaction                              â”‚
â”‚                                                          â”‚
â”‚  Redacts sensitive information:                          â”‚
â”‚    - IP addresses (internal)                             â”‚
â”‚    - Email addresses                                     â”‚
â”‚    - Credit card numbers                                 â”‚
â”‚    - SSNs                                                â”‚
â”‚    - API keys                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Prompt Construction                        â”‚
â”‚                                                          â”‚
â”‚  Builds LLM prompt with:                                 â”‚
â”‚    - Alert context                                       â”‚
â”‚    - Rule-specific guidance                              â”‚
â”‚    - Controlled vocabulary                               â”‚
â”‚    - JSON output format requirement                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OpenAI GPT-5.2 API Call                    â”‚
â”‚                                                          â”‚
â”‚  Request:                                                â”‚
â”‚    - Model: gpt-5.2                                      â”‚
â”‚    - Temperature: Dynamic (based on rule level)          â”‚
â”‚    - Max tokens: 1024                                    â”‚
â”‚    - Response format: JSON                              â”‚
â”‚                                                          â”‚
â”‚  Response:                                               â”‚
â”‚    - threat_level: "critical" | "high" | "medium" | "low"â”‚
â”‚    - confidence: 0.0-1.0                                â”‚
â”‚    - tags: ["web_attack", "sql_injection", ...]         â”‚
â”‚    - summary: "Human-readable analysis..."               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Response Parsing & Validation               â”‚
â”‚                                                          â”‚
â”‚  - Parse JSON response                                   â”‚
â”‚  - Validate threat_level (allowed values)                â”‚
â”‚  - Validate tags (allowed vocabulary)                     â”‚
â”‚  - Convert to numeric scores                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Score Calculation                          â”‚
â”‚                                                          â”‚
â”‚  LLM Score = f(threat_level, confidence)                 â”‚
â”‚    - critical + high confidence â†’ 0.9-1.0                â”‚
â”‚    - high + medium confidence â†’ 0.7-0.9                  â”‚
â”‚    - medium + low confidence â†’ 0.5-0.7                    â”‚
â”‚    - low â†’ 0.3-0.5                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¡ NOTIFICATION & ORCHESTRATION

### **Notification Payload Structure:**

```json
{
  "alert_id": "unique-alert-id",
  "timestamp": "2025-12-14T10:40:50Z",
  "rule_id": "31103",
  "rule_level": 7,
  "rule_description": "SQL Injection attempt detected",
  "threat_level": "HIGH",
  "score": 0.835,
  "heuristic_score": 0.72,
  "llm_score": 0.95,
  "llm_confidence": 1.0,
  "llm_summary": "SQL injection attempt detected...",
  "llm_tags": ["web_attack", "sql_injection"],
  "source": {
    "ip": "172.16.69.175",
    "port": 12345,
    "geoip": {
      "country": "VN",
      "city": "Ho Chi Minh"
    }
  },
  "destination": {
    "ip": "192.168.20.125",
    "port": 80,
    "hostname": "webserver.dmz.local"
  },
  "network": {
    "protocol": "HTTP",
    "method": "GET",
    "uri": "/dvwa/vulnerabilities/sqli/?id=1' OR '1'='1",
    "status_code": 200
  },
  "agent": {
    "id": "001",
    "name": "WebServer"
  },
  "critical_attack_override": false,
  "mitre_techniques": ["T1190"],
  "alert_card": {
    "title": "SQL Injection attempt on WebServer",
    "severity": "HIGH",
    "recommended_actions": [
      "Check web logs for successful exploitation",
      "Search for follow-up RCE attempts",
      "Consider blocking source IP if repeated"
    ]
  }
}
```

---

## ğŸ”§ IMPLEMENTATION DETAILS

### **1. Alert Collection Strategy**

**SOC Strategy - Balanced Agent Distribution:**
```python
# Query each agent separately to ensure balanced distribution
expected_agents = ["001", "002"]  # WebServer and pfSense

for agent_id in expected_agents:
    alerts = fetch_alerts_for_agent(agent_id)
    # Prevents one agent from flooding the pipeline
```

**Cursor Management:**
```python
# Cursor-based pagination for continuous fetching
cursor = {
    "timestamp": "2025-12-14T10:40:50.533Z",
    "sort_values": [...]
}

# Start from now (ignore old cursor)
if WAZUH_START_FROM_NOW:
    cursor_timestamp = now() - timedelta(minutes=WAZUH_LOOKBACK_MINUTES)
```

**Indexer Delay Compensation:**
```python
# Compensate for Wazuh Indexer delay (5-30s)
query_time = now() - timedelta(seconds=INDEXER_DELAY_SECONDS)
```

---

### **2. AI Processing Configuration**

**Dynamic Temperature:**
```python
# Adjust AI creativity based on rule severity
if rule_level >= 12:
    temperature = 0.3  # More deterministic for critical alerts
elif rule_level >= 7:
    temperature = 0.5  # Balanced
else:
    temperature = 0.7  # More creative for low-level alerts
```

**Rule-Specific Guidance:**
```python
# Provide specific guidance for critical rules
if rule_id == "31105":  # XSS
    prompt += "This is a Cross-Site Scripting (XSS) attack..."
elif rule_id == "31103":  # SQL Injection
    prompt += "This is a SQL Injection attack..."
```

**Controlled Vocabulary:**
```python
ALLOWED_TAGS = [
    "web_attack", "sql_injection", "xss", "command_injection",
    "csrf", "dos", "ddos", "webshell", "reverse_shell"
]

ALLOWED_THREAT_LEVELS = ["low", "medium", "high", "critical"]
```

---

### **3. Critical Attack Override**

**Mechanism:**
```python
def should_notify_critical_attack(alert):
    # Always notify for critical attacks, regardless of score
    if alert["rule_id"] in CRITICAL_ATTACK_RULES:
        return True
    if alert["rule_level"] >= 13:
        return True
    if "critical" in alert.get("llm_tags", []):
        return True
    return False
```

**Critical Rules:**
- Rule 110231: CONFIRMED Network connect (reverse shell)
- Rule 110230: CONFIRMED Command execution
- Rule 110202: CONFIRMED Webshell indicators
- Rule 100130: Command Injection
- Rule 100140: Suspicious Upload
- Rule 31110: CSRF attempt
- Rule 100160: HTTP DoS
- Rule 100170: TCP SYN Flood

---

## ğŸ”’ SECURITY CONSIDERATIONS

### **1. Network Security**

- **Segmentation:**
  - DMZ isolated from LAN
  - WebServer in DMZ (192.168.20.0/24)
  - Wazuh Server in LAN (192.168.10.0/24)
  - pfSense firewall rules between networks

- **Encryption:**
  - Wazuh API: HTTPS (Port 55000)
  - Wazuh Indexer: HTTPS (Port 9200)
  - n8n Webhook: HTTP (internal network)

### **2. Authentication & Authorization**

- **Wazuh API:**
  - Basic Auth: wazuh-wui / wazuh-wui
  - Or Token-based authentication

- **Wazuh Indexer:**
  - Basic Auth: admin / admin
  - SSL verification: Disabled (for testing)

- **OpenAI API:**
  - API Key authentication
  - Stored in .env file (not committed to git)

### **3. Data Privacy**

- **PII Redaction:**
  - IP addresses (internal)
  - Email addresses
  - Credit card numbers
  - SSNs
  - API keys

- **Alert Data:**
  - Only necessary fields sent to LLM
  - Sensitive data redacted before AI analysis
  - Full alert data available in Wazuh

### **4. Error Handling**

- **Retry Logic:**
  - Wazuh API: 3 retries with exponential backoff
  - OpenAI API: 3 retries with exponential backoff
  - n8n Webhook: 3 retries with exponential backoff

- **Graceful Degradation:**
  - If LLM fails â†’ Use heuristic score only
  - If n8n fails â†’ Log error, continue processing
  - If Wazuh fails â†’ Wait and retry

---

## ğŸ“Š PERFORMANCE METRICS

### **Processing Times:**
- Alert Collection: ~200ms per batch
- Heuristic Analysis: ~1ms per alert
- AI Analysis: ~2-3 seconds per alert
- Triage Fusion: ~1ms per alert
- Notification: ~100ms per alert

### **Throughput:**
- Alerts per minute: ~20-30 (depending on LLM latency)
- Batch size: 200 alerts
- Max batches: 5 batches per cycle

### **Resource Usage:**
- CPU: Low (mostly I/O bound)
- Memory: ~100-200 MB
- Network: ~1-2 MB/min (depending on alert volume)

---

## ğŸ¯ CONCLUSION

This architecture provides a comprehensive SOC solution that:

1. **Collects** alerts from Wazuh in real-time
2. **Analyzes** threats using both rule-based and AI-powered methods
3. **Prioritizes** alerts based on fused scores
4. **Notifies** SOC team via n8n workflows
5. **Orchestrates** response actions automatically

**Key Benefits:**
- âœ… Reduces alert fatigue
- âœ… Improves threat detection accuracy
- âœ… Accelerates incident response
- âœ… Provides contextual analysis
- âœ… Enables automated response

---

## ğŸ“š REFERENCES

- Wazuh Documentation: https://documentation.wazuh.com/
- OpenAI API Documentation: https://platform.openai.com/docs/
- n8n Documentation: https://docs.n8n.io/
- MITRE ATT&CK Framework: https://attack.mitre.org/

---

**Document Version:** 1.0  
**Last Updated:** 2025-12-14  
**Author:** SOC Architecture Team

